{% extends 'base.html' %}

{% block title %}{{ project.name }} - creatorLog{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <nav class="flex" aria-label="Breadcrumb">
                    <ol class="flex items-center space-x-4">
                        <li>
                            <a href="{% url 'projects:dashboard' %}" class="text-gray-400 hover:text-gray-300 transition duration-200">
                                <svg class="flex-shrink-0 h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L9 5.414V17a1 1 0 102 0V5.414l5.293 5.293a1 1 0 001.414-1.414l-7-7z"></path>
                                </svg>
                                <span class="sr-only">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <div class="flex items-center">
                                <svg class="flex-shrink-0 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="ml-4 text-sm font-medium text-gray-300">{{ project.name }}</span>
                            </div>
                        </li>
                    </ol>
                </nav>
                <h1 class="mt-2 text-3xl font-bold gradient-text">{{ project.name }}</h1>
                {% if project.description %}
                    <p class="mt-2 text-gray-400">{{ project.description }}</p>
                {% endif %}
            </div>
            <div class="flex space-x-3">
                <a href="{% url 'projects:edit_project' project.id %}" class="inline-flex items-center px-4 py-2 border border-dark-blue-600 rounded-md shadow-sm text-sm font-medium text-gray-300 bg-dark-blue-800 hover:bg-dark-blue-700 transition duration-200">
                    Edit Project
                </a>
            </div>
        </div>
    </div>

    <!-- Project Overview -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- MVP Requirements -->
            <div class="bg-dark-blue-800 rounded-lg shadow-lg border border-dark-blue-700">
                <div class="px-6 py-4 border-b border-dark-blue-700">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-white">MVP Requirements</h2>
                        <a href="{% url 'projects:create_mvp_requirement' project.id %}" class="text-accent-blue-400 hover:text-accent-blue-300 text-sm transition duration-200">
                            + Add Requirement
                        </a>
                    </div>
                </div>
                <div class="p-6">
                    {% if mvp_requirements %}
                        <div class="space-y-3">
                            {% for mvp in mvp_requirements %}
                                <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-dark-blue-700 transition duration-200">
                                    <button class="mvp-toggle flex-shrink-0 mt-1"
                                            hx-post="{% url 'projects:toggle_mvp_requirement' mvp.id %}"
                                            hx-trigger="click"
                                            hx-swap="none">
                                        <div class="w-5 h-5 rounded border-2 {% if mvp.completed %}bg-green-500 border-green-500{% else %}border-gray-400{% endif %} flex items-center justify-center transition duration-200">
                                            {% if mvp.completed %}
                                                <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                                </svg>
                                            {% endif %}
                                        </div>
                                    </button>
                                    <div class="flex-1">
                                        <p class="text-gray-300 {% if mvp.completed %}line-through text-gray-500{% endif %}">
                                            {{ mvp.description }}
                                        </p>
                                        {% if mvp.completed and mvp.completed_date %}
                                            <p class="text-xs text-green-400 mt-1">Completed {{ mvp.completed_date|date:"M j, Y" }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-gray-400 text-center py-8">No MVP requirements defined yet.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Task Backlog -->
            <div class="bg-dark-blue-800 rounded-lg shadow-lg border border-dark-blue-700">
                <div class="px-6 py-4 border-b border-dark-blue-700">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-white">Task Backlog</h2>
                        <a href="{% url 'projects:create_task' project.id %}" class="text-accent-blue-400 hover:text-accent-blue-300 text-sm transition duration-200">
                            + Add Task
                        </a>
                    </div>
                </div>
                <div class="p-6">
                    {% if tasks %}
                        <div class="space-y-3">
                            {% for task in tasks %}
                                <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-dark-blue-700 transition duration-200">
                                    <button class="task-toggle flex-shrink-0 mt-1"
                                            hx-post="{% url 'projects:toggle_task' task.id %}"
                                            hx-trigger="click"
                                            hx-swap="none">
                                        <div class="w-5 h-5 rounded border-2 {% if task.completed %}bg-green-500 border-green-500{% else %}border-gray-400{% endif %} flex items-center justify-center transition duration-200">
                                            {% if task.completed %}
                                                <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                                </svg>
                                            {% endif %}
                                        </div>
                                    </button>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="font-medium text-gray-300 {% if task.completed %}line-through text-gray-500{% endif %}">
                                                {{ task.title }}
                                            </h3>
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                                {% if task.priority == 'high' %}bg-red-900 text-red-100
                                                {% elif task.priority == 'medium' %}bg-yellow-900 text-yellow-100
                                                {% else %}bg-green-900 text-green-100{% endif %}">
                                                {{ task.get_priority_display }}
                                            </span>
                                        </div>
                                        {% if task.description %}
                                            <p class="text-sm text-gray-400 mt-1 {% if task.completed %}line-through{% endif %}">
                                                {{ task.description }}
                                            </p>
                                        {% endif %}
                                        {% if task.completed and task.completed_date %}
                                            <p class="text-xs text-green-400 mt-1">Completed {{ task.completed_date|date:"M j, Y" }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-gray-400 text-center py-8">No tasks added yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Project Status -->
            <div class="bg-dark-blue-800 rounded-lg shadow-lg border border-dark-blue-700 p-6">
                <h3 class="text-lg font-semibold text-white mb-4">Project Status</h3>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between text-sm text-gray-400 mb-1">
                            <span>Progress</span>
                            <span>{{ project.get_progress_percentage }}%</span>
                        </div>
                        <div class="w-full bg-dark-blue-700 rounded-full h-3">
                            <div class="progress-bar h-3 rounded-full transition-all duration-500" style="width: {{ project.get_progress_percentage }}%"></div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between">
                        <span class="text-gray-400">Status:</span>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                            {% if project.status == 'completed' %}bg-green-900 text-green-100
                            {% elif project.status == 'in_progress' %}bg-yellow-900 text-yellow-100
                            {% elif project.status == 'planning' %}bg-blue-900 text-blue-100
                            {% else %}bg-gray-900 text-gray-100{% endif %}">
                            {{ project.get_status_display }}
                        </span>
                    </div>
                    
                    {% if project.due_date %}
                        <div class="flex justify-between">
                            <span class="text-gray-400">Due Date:</span>
                            <span class="text-gray-300">{{ project.due_date|date:"M j, Y" }}</span>
                        </div>
                    {% endif %}
                    
                    <div class="flex justify-between">
                        <span class="text-gray-400">Created:</span>
                        <span class="text-gray-300">{{ project.created_date|date:"M j, Y" }}</span>
                    </div>
                </div>
            </div>

            <!-- Next Actions -->
            <div class="bg-dark-blue-800 rounded-lg shadow-lg border border-dark-blue-700 p-6">
                <h3 class="text-lg font-semibold text-white mb-4">Next Actions</h3>
                {% with next_task=project.get_next_task %}
                    {% if next_task %}
                        <div class="p-3 bg-dark-blue-700 rounded-lg">
                            <h4 class="font-medium text-accent-blue-400">Next Task</h4>
                            <p class="text-gray-300 mt-1">{{ next_task.title }}</p>
                            {% if next_task.description %}
                                <p class="text-sm text-gray-400 mt-1">{{ next_task.description|truncatewords:10 }}</p>
                            {% endif %}
                        </div>
                    {% else %}
                        <p class="text-gray-400">All tasks completed! 🎉</p>
                    {% endif %}
                {% endwith %}

                {% with last_completed=project.get_last_completed_task %}
                    {% if last_completed %}
                        <div class="mt-4 p-3 bg-green-900 bg-opacity-20 rounded-lg border border-green-700">
                            <h4 class="font-medium text-green-400">Last Completed</h4>
                            <p class="text-gray-300 mt-1">{{ last_completed.title }}</p>
                            <p class="text-xs text-green-400 mt-1">{{ last_completed.completed_date|date:"M j, Y" }}</p>
                        </div>
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
